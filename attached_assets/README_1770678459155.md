## Fireflies Connector for Pandora

**Status**: ✅ **PRODUCTION-READY** (extracted from RevOps Copilot)

**Category**: Conversations (Meeting Intelligence)
**Auth Method**: API Key (Bearer token)

---

### What This Connector Does

Syncs meeting recordings and transcripts from Fireflies.ai:
- **Transcripts**: Speaker-attributed conversation text
- **Meetings**: Metadata (title, date, duration, attendees)
- **Summaries**: AI-generated overview, action items, keywords
- **Attendees**: Participant names and emails

---

### Auth Setup

**API Key**: Get from Fireflies.ai settings → Integrations → API Key

**Credentials**:
```typescript
{
  apiKey: "YOUR_FIREFLIES_API_KEY"
}
```

---

### Objects Synced

#### Transcripts
- `id`, `title`, `date` (epoch milliseconds), `duration`
- `transcript_url`, `audio_url` - Recording links
- `summary.overview` - AI summary
- `summary.action_items` - Extracted action items
- `summary.keywords` - Key topics
- `participants` - Participant names (array of strings)
- `meeting_attendees` - Detailed attendee info (name, email, displayName)
- `host_email`, `organizer_email` - Meeting organizer
- `sentences` - Full transcript with speaker attribution and timestamps

---

### Sync Pattern

**GraphQL API**: Fireflies uses GraphQL queries

**Pagination**:
- Max 50 transcripts per page (API limit)
- Offset-based pagination (`skip` parameter)
- No cursor tokens

**Incremental Sync Strategy**:
- Filter by `afterDate` (client-side filtering - API doesn't support it natively)
- EDGE CASE: Date filtering happens AFTER fetch to preserve correct pagination

**Retry Pattern** (⭐ **CROWN JEWEL**):
- Exponential backoff: 1s → 2s → 4s
- Max 3 retries per page
- Consecutive error limit: stops if 3 consecutive page fetches fail
- 200ms delay between successful requests (be nice to API)
- Pattern extracted to `utils/retry.ts` for use by ALL connectors

---

### Edge Cases & How They're Handled

#### 1. **Pagination with Date Filtering**
**Problem**: Fireflies API doesn't support `afterDate` parameter natively

**Solution**:
- Fetch full pages first
- Filter client-side AFTER fetch
- Use raw page length (before filter) to determine when to stop pagination
- This ensures we don't stop early if filtered page is small

**Code Comment**:
```typescript
// EDGE CASE: Use rawPageLength (before afterDate filter) to ensure correct pagination
```

#### 2. **Sophisticated Retry Logic**
**Problem**: Transient API errors can fail entire syncs

**Solution** (extracted to `utils/retry.ts`):
- Exponential backoff with max 3 retries per page
- Consecutive error tracking (stop if 3 consecutive failures)
- Small delay (200ms) between successful requests
- Progress tracking with callbacks

**Pattern**:
```typescript
const transcripts = await paginatedFetchWithRetry(
  async (pageNum) => await fetchPage(pageNum),
  {
    maxPages: 20,
    pageDelay: 200,
    consecutiveErrorLimit: 3,
    retryConfig: { maxRetries: 3, baseDelay: 1000, backoffFactor: 2 }
  }
);
```

#### 3. **Speaker Consolidation**
**Problem**: Transcripts have one sentence per array entry - hard to read

**Solution**: `formatSentencesToTranscript()` helper
- Groups consecutive sentences by same speaker
- Formats as readable paragraphs: `Speaker Name: Full text of their turn...`

---

### Rate Limits

**Fireflies API Limits**: Not publicly documented, but conservative approach:
- 50 transcripts per page (API enforced)
- 200ms delay between requests (implemented)
- Retry logic handles rate limit errors

---

### Dependencies

**Node.js Built-ins**:
- `fetch` - HTTP requests

**Pandora Dependencies**:
- `utils/retry.ts` - Exponential backoff and paginated fetch utility

---

### TODO for Pandora

- [ ] Add explicit rate limiting if Fireflies publishes limits
- [ ] Link meetings to CRM deals/accounts (email-based matching)
- [ ] Store attendee → contact mappings
- [ ] Extract action items as Task entities

---

### Testing

**Test Connection**:
```typescript
const client = new FirefliesClient('YOUR_API_KEY');
const result = await client.testConnection();
console.log(result); // { success: true }
```

**Fetch All Transcripts**:
```typescript
const transcripts = await client.getAllTranscripts({
  afterDate: new Date('2026-01-01'),
  maxPages: 10,
  onProgress: (count) => console.log(`Fetched ${count} transcripts`)
});
```

---

### Summary

This connector showcases **best-in-class pagination and retry logic** that should be adopted by ALL Pandora connectors. The exponential backoff + consecutive error limit pattern prevents infinite retries while gracefully handling transient failures.
